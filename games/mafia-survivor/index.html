<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Blockscom Mafia Survival Game</title>
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
</head>

<body>

    <canvas id="gameCanvas"></canvas>

    <div id="rotate-overlay">
        <div class="rotate-message">
            <h1>ROTATE DEVICE</h1>
            <p>Please rotate your device to landscape mode to play.</p>
        </div>
    </div>

    <div id="ui-layer">
        <div id="debug-console" class="hidden"></div>

        <!-- TOP HUD -->
        <div class="hud-top">
            <!-- LEFT: Player Status -->
            <div class="hud-section hud-left">
                <div class="bar-container" id="hp-bar-container">
                    <div class="bar-wrapper">
                        <div class="bar-fill" id="hp-fill"></div>
                    </div>
                    <div class="bar-text-overlay">
                        <span>HP</span>
                        <span id="hp-text">100/100</span>
                    </div>
                </div>

                <!-- ARMOR BAR (Always visible) -->
                <div class="bar-container" id="armor-bar-container" style="border-color: #ffff00; margin-top: 4px;">
                    <div class="bar-wrapper">
                        <div class="bar-fill" id="armor-fill" style="background-color: #ffff00;"></div>
                    </div>
                    <div class="bar-text-overlay" style="color: #ffff00;">
                        <span>ARMOR</span>
                        <span id="armor-text">0/0</span>
                    </div>
                </div>

                <div class="bar-container" id="xp-bar-container"
                    style="border-color: var(--ui-gold); width: 200px; height: 16px;">
                    <div class="bar-wrapper">
                        <div class="bar-fill" id="xp-fill"></div>
                    </div>
                    <div class="bar-text-overlay">
                        <span>XP</span>
                        <span id="lvl-text">LVL 1</span>
                    </div>
                </div>
            </div>

            <!-- RIGHT COLUMN -->
            <div class="hud-column-right">
                <!-- RIGHT: Currency & Score -->
                <div class="hud-section hud-right">
                    <div id="timer-container">
                        <div id="timer">00:00</div>
                    </div>
                    <div class="info-panel">
                        <div class="info-text">CASH: $<span id="cash-text">0</span></div>
                        <div class="sub-text">MULTIPLIER: x<span id="cash-rate">1</span></div>
                    </div>
                    <!-- Placeholder for Wave or other stats -->
                    <div class="info-panel">
                        <div class="info-text" style="color: #fff;">WAVE <span id="wave-text">1</span></div>
                    </div>
                    <div class="info-panel">
                        <div class="info-text" style="color: #ff5555;">KILLS <span id="kill-count">0</span></div>
                    </div>
                </div>

                <!-- FULLSCREEN ICON BTN -->
                <button id="fullscreen-icon-btn" onclick="toggleFullscreen()" title="Toggle Fullscreen">
                    <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M7 10V7H10" stroke="currentColor" stroke-width="3" stroke-linecap="round"
                            stroke-linejoin="round" />
                        <path d="M17 10V7H14" stroke="currentColor" stroke-width="3" stroke-linecap="round"
                            stroke-linejoin="round" />
                        <path d="M7 14V17H10" stroke="currentColor" stroke-width="3" stroke-linecap="round"
                            stroke-linejoin="round" />
                        <path d="M17 14V17H14" stroke="currentColor" stroke-width="3" stroke-linecap="round"
                            stroke-linejoin="round" />
                    </svg>
                </button>
            </div>
        </div>

        <!-- BOTTOM HUD -->
        <div class="hud-bottom">
            <!-- LEFT: Buffs & Items -->
            <div class="hud-section hud-left">
                <div id="buff-tracker">
                    <div class="buff-item" style="color: var(--ui-red);">DMG: <span id="stack-dmg">0</span></div>
                    <div class="buff-item" style="color: var(--ui-green);">HP: <span id="stack-hp">0</span></div>
                    <div class="buff-item" style="color: var(--ui-blue);">SPD: <span id="stack-spd">0</span></div>
                </div>

                <!-- Safety Box UI (Moved here) -->
                <div id="safety-box-ui" class="hidden">
                    <div class="spin-label">OPENING SAFETY BOX...</div>
                    <div class="spinner-window">
                        <div id="spinner-text">???</div>
                    </div>
                    <div id="box-pending" class="pending-count">PENDING: 0</div>
                </div>
            </div>

            <!-- RIGHT: Controls & Weapon -->
            <div class="hud-section hud-right">
                <div id="stats-panel" class="hidden">
                    <div class="stat-header">STATS</div>
                    <div id="stat-weapon" style="color: var(--ui-gold);">PISTOL</div>
                    <div class="stat-row">DMG: <span id="stat-dmg">10</span></div>
                    <div class="stat-row">ATK SPD: <span id="stat-fr">35</span></div>
                    <div class="stat-row">SPD: <span id="stat-spd">1.5</span></div>
                    <div class="stat-row">PROJ: <span id="stat-proj">1</span></div>
                    <div id="ability-list"></div>
                </div>

                <div id="outpost-controls">
                    <button id="upgrade-btn" class="btn hidden"
                        style="padding: 8px 12px; font-size: 10px; width: 160px;">
                        UPGRADE
                    </button>
                    <button id="build-tower-btn" class="btn hidden"
                        style="padding: 8px 12px; font-size: 10px; width: 160px;">
                        BUILD TOWER ($200)
                    </button>
                </div>
            </div>



        </div>

        <!-- MODALS -->

        <!-- LOGIN SCREEN -->
        <div id="login-screen" class="modal">
            <div class="pixel-window">
                <h1>Blockscom Mafia<br>Survival Game</h1>
                <p>make your own game with Blockscom</p>
                <button class="btn btn-gold" onclick="connectWallet()">CONNECT WALLET</button>
                <button class="btn" onclick="startGame()">PLAY AS GUEST</button>
                <p id="wallet-status" style="margin-top:20px; font-size: 10px; color: var(--ui-red);"></p>
            </div>
        </div>

        <!-- LEVEL UP SCREEN -->
        <div id="levelup-screen" class="modal hidden">
            <div class="pixel-window" style="max-width: 1000px;">
                <div class="tabs-header">
                    <div class="tab active">UPGRADES</div>
                    <div class="tab">STATS</div>
                    <div class="tab">WEAPONS</div>
                </div>
                <h1>LEVEL UP!</h1>
                <div class="card-container" id="upgrade-cards"></div>
            </div>
        </div>

        <!-- GAME OVER SCREEN -->
        <div id="gameover-screen" class="modal hidden">
            <div class="pixel-window">
                <h1 style="color: var(--ui-red);">WASTED</h1>
                <p id="final-stats">Survived: 00:00</p>
                <button class="btn" onclick="location.reload()">TRY AGAIN</button>
            </div>
        </div>

    </div>

    <script src="js/visuals.js"></script>
    <script src="js/lightning.js"></script>
    <script src="js/map.js"></script>
    <script src="js/player.js"></script>
    <script src="js/outpost.js"></script>
    <script src="js/tower.js"></script>
    <script src="js/ui.js"></script>
    <script src="js/mobile.js"></script>
    <script src="js/game.js"></script>
</body>

</html>